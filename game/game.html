<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Игра "Ladakh Rider" - Кто в Лех, кто по дрова?</title>
  <meta name="description" content="Игра от сообщества русскоязычных путешественников в Гималаях, Тибете и Ладаке." />
  <meta property="og:image" content="https://cdn.glitch.global/bea12857-f511-461d-adbc-da5b46687f87/IMG_20231118_212542_728.jpg?v=1750048499482">
  <link rel="icon" href="IMG_20231118_212542_728.ico" type="image/x-icon">
  <style>
    html {
      overflow-x: hidden;  
    }
    
    body {
      overflow-x: hidden;  
      margin: 0;
      font-family: 'Lora', serif;
      color: #fff;
      background: url('https://cdn.glitch.global/bea12857-f511-461d-adbc-da5b46687f87/IMG_20231118_212542_728.jpg?v=1750048499482') no-repeat center center fixed;
      background-size: cover;
      line-height: 1.6;
    }
    header {
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    h2, p {
      text-align: center;
    }
    main {
      background: rgba(0, 0, 0, 0.5);
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 8px;
    }
    
    .game-container {
      position: relative;
      width: 100%;
      height: 500px;
      margin: 20px auto;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }
    
    #canvas1 {
      width: 100%;
      height: 100%;
      background: rgb(122, 122, 177);
    }
    
    .admin-link-leh {
      display: flex;
      justify-content: center;
      align-items: center;
      color: #00b2ff;
      text-decoration: none;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .admin-link-leh svg{
      width: 20px;
      height: 20px;
      margin-right: 8px;
      fill: #00b2ff;
    }
    
    a {
      align-items: center;
      font-weight: bold;
      font-size: 1.1em;
      padding: 10px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.75);
      transition: background 0.3s ease;
    }
    
    footer {
      text-align: center;
      padding: 10px;
      color: black;
      font-size: 0.9rem;
    }
    
    /* Hide game assets */
    #layer1, #layer2, #layer3, #layer4, #player, 
    #backingtrack_music, #sound_gaz, #sound_stop {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>Игра "Ladakh Rider" от сообщества "Кто в Лех, кто по дрова?"</h1><br>
    <a href="https://t.me/leh_ladak" class="admin-link-leh" target="_blank" rel="noopener noreferrer">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.371 0 0 5.371 0 12s5.371 12 12 12 12-5.371 12-12S18.629 0 12 0zm5.963 7.57l-1.79 8.427c-.135.582-.485.726-1.008.452l-2.792-2.063-1.346 1.296c-.148.147-.271.271-.555.271l.2-2.869 5.217-4.71c.226-.2-.05-.312-.35-.112l-6.453 4.063-2.773-.865c-.602-.185-.613-.602.127-.89l10.843-4.18c.503-.185.944.112.783.883z"/></svg>
      Наш Telegram-канал
    </a>
    <a href="../index.html" class="admin-link-leh" rel="noopener noreferrer">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.371 0 0 5.371 0 12s5.371 12 12 12 12-5.371 12-12S18.629 0 12 0zm5.963 7.57l-1.79 8.427c-.135.582-.485.726-1.008.452l-2.792-2.063-1.346 1.296c-.148.147-.271.271-.555.271l.2-2.869 5.217-4.71c.226-.2-.05-.312-.35-.112l-6.453 4.063-2.773-.865c-.602-.185-.613-.602.127-.89l10.843-4.18c.503-.185.944.112.783.883z"/></svg>
      На главную
    </a>
  </header>
  
  <main>
    <section>
      <h2>Гонки по Ладакху</h2>
      <p>Прокатитесь на мотоцикле по живописным дорогам Ладакха! Управляйте стрелками или свайпами на телефоне.</p>
      
      <div class="game-container">
        <canvas id="canvas1"></canvas>
      </div>
      
      <p>Управление: стрелки клавиатуры (↑↓←→) или свайпы на сенсорном экране</p>
    </section>
  </main>
  
  <footer>
    &copy; 2025 Кто в Лех, кто по дрова?
  </footer>
  
  <!-- Game assets (hidden) -->
  <audio id="backingtrack_music" src="african_rock_game.mp3"></audio>
  <audio id="sound_gaz" src="gaz_moto.mp3"></audio>
  <audio id="sound_stop" src="stopping_moto.mp3"></audio>
  
  <img id="player" src="player.png">
  <img id="layer1" src="layer1.png">
  <img id="layer2" src="layer2.png">
  <img id="layer3" src="layer3.png">
  <img id="layer4" src="layer4.png">

  <script>
    window.addEventListener('load', function(){
      const canvas = document.getElementById('canvas1');
      const ctx = canvas.getContext('2d');
      
      // Set canvas size to container size
      const container = document.querySelector('.game-container');
      canvas.width = container.offsetWidth;
      canvas.height = container.offsetHeight;
      
      // Request fullscreen (commented out as it might be intrusive)
      // document.documentElement.fullscreen = true;
      // canvas.requestFullscreen();

      class Layer{
        constructor(game, image, speedModifier){
          this.game = game;
          this.image = image;
          this.speedModifier = speedModifier;
          this.width = 1768;
          this.height = 500;
          this.x = 0;
          this.y = 0;  
        }
        update(){
          if (this.x <= -this.width) this.x = 0;
          else this.x -= this.game.speed * this.speedModifier;
        }
        draw(context){
          context.drawImage(this.image, this.x, this.y)
          context.drawImage(this.image, this.x+this.width, this.y)
        }
      }  

      class Music{
        constructor(game){
          this.game = game;
          this.media = document.getElementById('backingtrack_music');
          this.sound_gaz = document.getElementById('sound_gaz');
          this.sound_stop = document.getElementById('sound_stop');
          
          this.media.volume = 0.5;
          this.media.loop = true;
          this.media.play();
        }
      }
  
      class Background{
        constructor(game){
          this.game = game;
          this.image1 = document.getElementById('layer1');
          this.image2 = document.getElementById('layer2');
          this.image3 = document.getElementById('layer3');
          this.image4 = document.getElementById('layer4');
          this.layer1 = new Layer(this.game, this.image1, 0.2);
          this.layer2 = new Layer(this.game, this.image2, 0.5);
          this.layer3 = new Layer(this.game, this.image3, 1);
          this.layer4 = new Layer(this.game, this.image4, 1.7);
          this.layers = [this.layer1,this.layer2,this.layer3];
        }
        update(){
          this.layers.forEach(layer => layer.update());
        }
        draw(context){
          this.layers.forEach(layer => layer.draw(context));
        }
      }  
  
      class InputHandler {
        constructor(game) {
          this.game = game;
          this.touchId = null;
          this.touchThreshold = 10;
          
          window.addEventListener('keydown', e => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key) &&
                !this.game.keys.includes(e.key)) {
              this.game.keys.push(e.key);
            }
          });
          
          window.addEventListener('keyup', e => {
            const index = this.game.keys.indexOf(e.key);
            if (index > -1) {
              this.game.keys.splice(index, 1);
            }
          });

          window.addEventListener('touchstart', e => {
            if (this.touchId === null) {
              const touch = e.touches[0];
              this.touchId = touch.identifier;
              this.game.touchStartX = touch.clientX;
              this.game.touchStartY = touch.clientY;
              this.game.isTouching = true;
            }
          });

          window.addEventListener('touchmove', e => {
            if (!this.game.isTouching) return;
            
            const touch = Array.from(e.touches).find(t => t.identifier === this.touchId);
            if (!touch) return;
            
            const currentX = touch.clientX;
            const currentY = touch.clientY;
            
            this.game.touchDeltaX = currentX - this.game.touchStartX;
            this.game.touchDeltaY = currentY - this.game.touchStartY;
            
            if (Math.abs(this.game.touchDeltaX) > this.touchThreshold || 
                Math.abs(this.game.touchDeltaY) > this.touchThreshold) {
              this.game.isSliding = true;
            }
          });

          window.addEventListener('touchend', e => {
            const touch = Array.from(e.changedTouches).find(t => t.identifier === this.touchId);
            if (touch) {
              this.game.isTouching = false;
              this.game.isSliding = false;
              this.touchId = null;
              this.game.touchDeltaX = 0;
              this.game.touchDeltaY = 0;
            }
          });
        }
      }    
      
      class Player{
        constructor (game){
          this.game = game;
          this.width = 166;
          this.height = 215;
          this.x = 20;
          this.y = 227;
          this.xLimitRight = this.game.width-this.width;
          this.xLimitLeft = 0;
          this.yLimitUp = 185;
          this.yLimitDown = this.game.height-this.height;
          this.frameX = 0;
          this.frameY = 0;
          this.maxFrame = 2;
          this.speedX = 0;
          this.speedY = 0;
          this.maxSpeedY = 3;
          this.maxSpeedX = 7;
          this.maxSpeedYslide = 0.5;
          this.maxSpeedXslide = 2;
          this.image = document.getElementById('player');
        }
        update(){
          if (this.game.keys.includes('ArrowUp')) this.speedY = -this.maxSpeedY;
          else if (this.game.keys.includes('ArrowDown')) this.speedY = this.maxSpeedY;
          else if (this.game.keys.includes('ArrowLeft')) {
            this.speedX = -this.maxSpeedX;
            this.game.sound_stop_bool = true;
          }
          else if (this.game.keys.includes('ArrowRight')) {
            this.speedX = this.maxSpeedX;
            this.game.sound_gaz_bool = true;
          }
          else {
            this.speedY = 0; 
            this.speedX = 0;
            this.game.sound_gaz_bool = false;
            this.game.sound_stop_bool = true;
          }

          if (this.game.touchDeltaX > 0) {
            this.game.sound_gaz_bool = true;
            this.speedX = this.maxSpeedXslide;
          }
          else if (this.game.touchDeltaX < 0) {
            this.game.sound_gaz_bool = false;
            this.speedX = -this.maxSpeedXslide;
          }
          
          if (this.game.isSliding == false) {
            this.game.sound_gaz_bool = false;
            this.speedX = 0;
          }
        
          if (this.game.touchDeltaY > 0) {
            this.speedY = this.maxSpeedYslide;
          }
          else if (this.game.touchDeltaY < 0) {
            this.speedY = -this.maxSpeedYslide;
          }
          
          if (this.game.isSliding == false) {
            this.speedY = 0;
          }
        
          this.y += this.speedY;
          this.x += this.speedX;
          
          if (this.x < this.xLimitLeft) this.x = this.xLimitLeft;
          if (this.x > this.xLimitRight) this.x = this.xLimitRight;
          if (this.y > this.yLimitDown) this.y = this.yLimitDown;
          if (this.y < this.yLimitUp) this.y = this.yLimitUp;
          
          if (this.frameX < this.maxFrame) {
            this.frameX++;
          } else {
            this.frameX = 0;
          }
        }
      
        draw(context){
          context.drawImage(this.image,this.frameX*this.width,this.frameY*this.height,this.width,this.height,this.x,this.y,this.width,this.height);

          if (this.game.sound_gaz_bool) this.game.music.sound_gaz.play();
          if (this.game.sound_stop_bool) this.game.music.sound_stop.play();
        }
      }

      class Game{
        constructor(width, height){
          this.width = width;
          this.height = height;
          this.background = new Background(this);
          this.player = new Player(this);
          this.music = new Music(this);
          this.input = new InputHandler(this);
          this.keys = [];
          this.speed = 1;
          this.sound_gaz_bool = false;
          this.sound_stop_bool = true;
          this.touchStartY = 0;
          this.touchStartX = 0;
          this.isSlidind = false;
          this.touchDeltaY = 0;
          this.touchDeltaX = 0;
        }
        update(){
          this.background.layer4.update();
          this.player.update();
          this.background.update();
        }
        draw(context){
          this.background.draw(context);
          this.player.draw(context);
          this.background.layer4.draw(context);
        }
      }
      
      const game = new Game(canvas.width,canvas.height);
     
      const audio = document.getElementById('backingtrack_music');
      audio.loop = true;
      audio.volume = 0.9;
      audio.play(); 
  
      function animate(){
        game.update();
        game.draw(ctx);
        requestAnimationFrame(animate);
      }
      animate();
    });
  </script>
</body>
</html>
