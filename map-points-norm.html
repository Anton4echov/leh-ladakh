<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ö–∞—Ä—Ç–∞ –õ–∞–¥–∞–∫—Ö–∞ ‚Äî –í–∞—à–∏ –º–µ—Å—Ç–∞</title>
  <meta name="description" content="–°–æ–æ–±—â–µ—Å—Ç–≤–æ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –≤ –ì–∏–º–∞–ª–∞—è—Ö, –¢–∏–±–µ—Ç–µ –∏ –õ–∞–¥–∞–∫–µ. –î–µ–ª–∏–º—Å—è –æ–ø—ã—Ç–æ–º, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –∏ —Å–æ–≤–µ—Ç–∞–º–∏." />
  <meta property="og:image" content="https://cdn.glitch.global/bea12857-f511-461d-adbc-da5b46687f87/IMG_20231118_212542_728.jpg?v=1750048499482">
  <link rel="icon" href="IMG_20231118_212542_728.ico" type="image/x-icon">
  <meta name="keywords" content="–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –ì–∏–º–∞–ª–∞–∏, –¢–∏–±–µ—Ç, –õ–∞–¥–∞–∫, —Ç—É—Ä–∏–∑–º, —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ, –ö—Ç–æ –≤ –õ–µ—Ö, –∫—Ç–æ –ø–æ –¥—Ä–æ–≤–∞, –õ–µ—Ö" />
  <meta name="google-site-verification" content="Vy_7IEiB5LnDvD_vopy0n6hge5lkuvSpSYA_0hAaePQ" />
  <link rel="canonical" href="https://leh-ladakh.onrender.com/" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css" />
<style>
  body {
    margin: 0;
    font-family: 'Lora', serif;
    background: url('https://cdn.glitch.global/bea12857-f511-461d-adbc-da5b46687f87/IMG_20231118_212542_728.jpg?v=1750048499482') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }
  header {
    background: rgba(0,0,0,0.6);
    padding: 20px;
    text-align: center;
  }
  h1 { margin: 0; font-size: 1.2rem; }
  main {
    background: rgba(0,0,0,0.6);
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
    border-radius: 8px;
  }
  #map { 
    height: 600px; 
    width: 100%; 
    border-radius: 8px; 
    margin-top: 20px; 
    position: relative; 
  }
  .upload-section, .action-buttons, .stats, .info {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
  }
  .upload-section input[type="file"] { width: 100%; padding: 8px; margin-top: 10px; border-radius: 5px; border: none; }
  .action-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .action-buttons button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    flex: 1;
    min-width: 200px;
  }
  .save-btn { background: #27ae60; color: white; }
  .orange { background: #f39c12; color: white; }
  .clear-btn { background: #e74c3c; color: white; }
  .delete-all-btn { background: #8e44ad; color: white; }
  .download-btn { background: #3498db; color: white; }
  .places-list-item { 
    margin: 5px 0; 
    padding: 8px; 
    background: rgba(255,255,255,0.15); 
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .places-list-item:hover {
    background: rgba(255,255,255,0.25);
  }
  .map-controls {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    background: rgba(0,0,0,0.7);
    padding: 10px;
    border-radius: 5px;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  .map-controls button {
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s;
  }
  .map-controls button:hover {
    background: rgba(255,255,255,0.3);
  }
  .place-type {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-left: 10px;
    color: white;
  }
  .type-custom {
    background: #27ae60;
  }
  .type-default {
    background: #3498db;
  }
  
  /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ */
  .admin-link-leh {
    display: flex;
    justify-content: center;
    align-items: center;
    color: #00b2ff;
    text-decoration: none;
    margin-bottom: 8px;
    font-weight: bold;
    opacity: 0;
    animation: slideInFromRight 0.6s forwards;
  }
  
  .admin-link-leh svg{
    width: 20px;
    height: 20px;
    margin-right: 8px;
    fill: #00b2ff;
  }
  
  .admin-link {
    display: flex;
    justify-content: center;
    align-items: center;
    color: #00b2ff;
    text-decoration: none;
    margin-bottom: 8px;
    font-weight: bold;
    opacity: 0;
    animation: slideInFromRight 0.6s forwards;
  }
  
  .admin-link svg {
    width: 20px;
    height: 20px;
    margin-right: 8px;
    fill: #00b2ff;
  }
  
  a {
    align-items: center;
    font-weight: bold;
    font-size: 1.1em;
    padding: 10px 16px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.75);
    transition: background 0.3s ease;
  }
  
  @keyframes slideInFromRight {
    0% {
      opacity: 0;
      transform: translateX(50px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Animation delays for top buttons */
  .admin-link-leh:nth-child(2) { animation-delay: 0.5s; }
  .admin-link-leh:nth-child(3) { animation-delay: 1s; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤ OpenLayers */
  .custom-marker {
    font-size: 24px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  }
  .default-marker {
    font-size: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  }
</style>
</head>
<body>
<header>
  <h1>–ö–∞—Ä—Ç–∞ –õ–∞–¥–∞–∫—Ö–∞ ‚Äî –í–∞—à–∏ –º–µ—Å—Ç–∞</h1><br>
    <a href="https://t.me/leh_ladak" class="admin-link-leh" target="_blank" rel="noopener noreferrer">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.371 0 0 5.371 0 12s5.371 12 12 12 12-5.371 12-12S18.629 0 12 0zm5.963 7.57l-1.79 8.427c-.135.582-.485.726-1.008.452l-2.792-2.063-1.346 1.296c-.148.147-.271.271-.555.271l.2-2.869 5.217-4.71c.226-.2-.05-.312-.35-.112l-6.453 4.063-2.773-.865c-.602-.185-.613-.602.127-.89l10.843-4.18c.503-.185.944.112.783.883z"/></svg>
      –ù–∞—à Telegram-–∫–∞–Ω–∞–ª
    </a>
    <a href="../index.html" class="admin-link-leh" rel="noopener noreferrer">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.371 0 0 5.371 0 12s5.371 12 12 12 12-5.371 12-12S18.629 0 12 0zm5.963 7.57l-1.79 8.427c-.135.582-.485.726-1.008.452l-2.792-2.063-1.346 1.296c-.148.147-.271.271-.555.271l.2-2.869 5.217-4.71c.226-.2-.05-.312-.35-.112l-6.453 4.063-2.773-.865c-.602-.185-.613-.602.127-.89l10.843-4.18c.503-.185.944.112.783.883z"/></svg>
      –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>
</header>
<main>
  <div class="upload-section">
    <h3>–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª —Å –º–µ—Å—Ç–∞–º–∏</h3>
    <input type="file" id="file-input" accept=".csv" />
    <p>–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏: name, latitude, longitude, description</p>
  </div>

  <div class="stats" id="stats">
    –í—Å–µ–≥–æ –º–µ—Å—Ç –Ω–∞ –∫–∞—Ä—Ç–µ: <span id="points-count">0</span>
  </div>

  <div class="action-buttons">
    <button class="save-btn" id="save-all-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞</button>
    <button class="orange" id="save-new-btn">üÜï –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞</button>
    <button class="download-btn" id="download-food-btn">üì• –°–∫–∞—á–∞—Ç—å –º–µ—Å—Ç–∞ food-le.csv</button>
    <button class="clear-btn" id="clear-custom-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Å—Ç–∞</button>
    <button class="delete-all-btn" id="delete-all-btn">üí• –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞</button>
  </div>

  <div id="map">
    <div class="map-controls">
      <button id="reset-view">üìç –í–µ—Ä–Ω—É—Ç—å –∫ –õ–∞–¥–∞–∫—Ö—É</button>
      <button class="save-btn" id="quick-save-btn">üíæ –í—Å–µ –º–µ—Å—Ç–∞</button>
      <button class="orange" id="quick-save-new-btn">üÜï –ù–æ–≤—ã–µ –º–µ—Å—Ç–∞</button>
      <button class="download-btn" id="quick-download-food-btn">üì• food-le.csv</button>
      <button class="delete-all-btn" id="quick-delete-all-btn">üí• –í—Å–µ –º–µ—Å—Ç–∞</button>
    </div>
  </div>

  <div class="info">
    <h3>üìã –°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç:</h3>
    <ul id="places-list" style="list-style: none; padding-left: 0; max-height: 300px; overflow-y: auto;"></ul>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>
<script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã OpenLayers
  const map = new ol.Map({
    target: 'map',
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      })
    ],
    view: new ol.View({
      center: ol.proj.fromLonLat([77.5771, 34.1526]),
      zoom: 8
    })
  });

  // –í–µ–∫—Ç–æ—Ä–Ω—ã–π —Å–ª–æ–π –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
  const vectorSource = new ol.source.Vector();
  const vectorLayer = new ol.layer.Vector({
    source: vectorSource
  });
  map.addLayer(vectorLayer);

  let allPlaces = [];
  let lastSaveTime = new Date();
  
  const samplePlaces = [
    { name: "–õ–µ—Ö", lat: 34.1526, lng: 77.5771, description: "–°—Ç–æ–ª–∏—Ü–∞ –õ–∞–¥–∞–∫—Ö–∞" },
    { name: "–ú–æ–Ω–∞—Å—Ç—ã—Ä—å –¢–∏–∫—Å–∏", lat: 34.0675, lng: 77.6653, description: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –º–æ–Ω–∞—Å—Ç—ã—Ä—å –≤ –õ–∞–¥–∞–∫—Ö–µ" },
    { name: "–û–∑–µ—Ä–æ –ü–∞–Ω–≥–æ–Ω–≥", lat: 33.7234, lng: 78.7711, description: "–í—ã—Å–æ–∫–æ–≥–æ—Ä–Ω–æ–µ —Å–æ–ª–µ–Ω–æ–µ –æ–∑–µ—Ä–æ" },
    { name: "–ü–µ—Ä–µ–≤–∞–ª –ö—Ö–∞—Ä–¥—É–Ω–≥-–õ–∞", lat: 34.2819, lng: 77.6183, description: "–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –≤—ã—Å–æ–∫–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–≤–∞–ª–æ–≤ –≤ –º–∏—Ä–µ" },
    { name: "–î–≤–æ—Ä–µ—Ü –õ–µ—Ö", lat: 34.1667, lng: 77.5833, description: "–ë—ã–≤—à–∏–π –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –¥–≤–æ—Ä–µ—Ü" },
    { name: "–ú–æ–Ω–∞—Å—Ç—ã—Ä—å –•–µ–º–∏—Å", lat: 33.9117, lng: 77.7142, description: "–ö—Ä—É–ø–Ω—ã–π –º–æ–Ω–∞—Å—Ç—ã—Ä—å —à–∫–æ–ª—ã –î—Ä–∏–∫—É–Ω–≥ –ö–∞–≥—å—é" },
    { name: "–î–æ–ª–∏–Ω–∞ –ù—É–±—Ä–∞", lat: 34.6167, lng: 77.4667, description: "–í—ã—Å–æ–∫–æ–≥–æ—Ä–Ω–∞—è –ø—É—Å—Ç—ã–Ω—è —Å –ø–µ—Å—á–∞–Ω—ã–º–∏ –¥—é–Ω–∞–º–∏" }
  ];

  function updateStats() {
    const placesCount = allPlaces.length;
    const customCount = allPlaces.filter(p => p.isCustom).length;
    document.getElementById('points-count').textContent = `${placesCount} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö: ${customCount})`;
    
    const list = document.getElementById('places-list');
    list.innerHTML = '';
    
    allPlaces.forEach(place => {
      const item = document.createElement('li');
      item.className = 'places-list-item';
      
      const typeBadge = place.isCustom ? 
        '<span class="place-type type-custom">–ù–æ–≤–æ–µ</span>' : 
        '<span class="place-type type-default">–°—Ç–∞–Ω–¥–∞—Ä—Ç</span>';
      
      item.innerHTML = `<b>${place.name}</b> ${typeBadge}<br>${place.lat.toFixed(4)}, ${place.lng.toFixed(4)}<br>${place.description}`;
      item.onclick = () => {
        map.getView().setCenter(ol.proj.fromLonLat([place.lng, place.lat]));
        map.getView().setZoom(12);
      };
      list.appendChild(item);
    });
  }

  function addMarker(place, isCustom = false) {
    const feature = new ol.Feature({
      geometry: new ol.geom.Point(ol.proj.fromLonLat([place.lng, place.lat])),
      name: place.name,
      description: place.description || '',
      isCustom: isCustom
    });

    // –°—Ç–∏–ª—å –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
    const style = new ol.style.Style({
      image: new ol.style.Icon({
        src: 'data:image/svg+xml;utf8,' + encodeURIComponent(`
          <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <circle cx="16" cy="16" r="14" fill="${isCustom ? '#27ae60' : '#e74c3c'}" stroke="white" stroke-width="2"/>
            <text x="16" y="22" text-anchor="middle" fill="white" font-size="16">${isCustom ? 'üìç' : 'üî¥'}</text>
          </svg>
        `),
        scale: 1,
        anchor: [0.5, 1]
      })
    });

    feature.setStyle(style);
    vectorSource.addFeature(feature);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
    const element = document.createElement('div');
    element.innerHTML = `<b>${place.name}</b><br>${place.description || ''}`;
    
    const overlay = new ol.Overlay({
      element: element,
      positioning: 'bottom-center',
      stopEvent: false,
      offset: [0, -10]
    });
    
    map.addOverlay(overlay);
    
    feature.set('overlay', overlay);
    feature.set('element', element);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ
    feature.on('click', function(evt) {
      overlay.setPosition(evt.coordinate);
      element.style.display = 'block';
    });

    allPlaces.push({ 
      feature,
      name: place.name, 
      lat: place.lat, 
      lng: place.lng, 
      description: place.description || '', 
      isCustom, 
      created: new Date() 
    });
    
    updateStats();
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Å—Ç
  map.on('click', function(evt) {
    const coordinate = evt.coordinate;
    const lonLat = ol.proj.toLonLat(coordinate);
    const lat = lonLat[1];
    const lon = lonLat[0];

    const name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞:");
    if (!name) return;

    const description = prompt("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):") || "";

    addMarker({ name, lat, lng: lon, description }, true);
  });

  // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –º–µ—Å—Ç
  function deleteAllPoints() {
    if (allPlaces.length === 0) {
      alert('–ù–µ—Ç –º–µ—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!');
      return;
    }

    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï ${allPlaces.length} –º–µ—Å—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã —Å –∫–∞—Ä—Ç—ã
      allPlaces.forEach(place => {
        vectorSource.removeFeature(place.feature);
        if (place.feature.get('overlay')) {
          map.removeOverlay(place.feature.get('overlay'));
        }
      });
      
      // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ –º–µ—Å—Ç
      allPlaces = [];
      
      updateStats();
      alert('üí• –í—Å–µ –º–µ—Å—Ç–∞ —É–¥–∞–ª–µ–Ω—ã!');
    }
  }

  function saveAllPoints(){
    if(!allPlaces.length) { alert('–ù–µ—Ç –º–µ—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!'); return; }
    
    let filename = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è):", "ladakh_all_places");
    if (!filename) return;
    
    let csv = "name,latitude,longitude,description,type\n";
    allPlaces.forEach(place => {
      const escapedName = `"${place.name.replace(/"/g, '""')}"`;
      const escapedDescription = `"${(place.description || '').replace(/"/g, '""')}"`;
      csv += `${escapedName},${place.lat},${place.lng},${escapedDescription},${place.isCustom?'custom':'default'}\n`;
    });
    
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); 
    const a = document.createElement('a'); 
    a.href = URL.createObjectURL(blob); 
    a.download = `${filename}.csv`; 
    a.click();
    
    lastSaveTime = new Date();
    alert(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${allPlaces.length} –º–µ—Å—Ç –≤ —Ñ–∞–π–ª ${filename}.csv`);
  }

  function saveNewPoints() {
    const newPlaces = allPlaces.filter(place => place.isCustom && place.created > lastSaveTime);
    if (newPlaces.length === 0) { alert('–ù–µ—Ç –Ω–æ–≤—ã—Ö –º–µ—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!'); return; }

    let filename = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –º–µ—Å—Ç (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è):", "ladakh_new_places");
    if (!filename) return;

    let csvContent = "name,latitude,longitude,description\n";
    newPlaces.forEach(place => {
      const escapedName = `"${place.name.replace(/"/g, '""')}"`;
      const escapedDescription = `"${(place.description || '').replace(/"/g, '""')}"`;
      csvContent += `${escapedName},${place.lat},${place.lng},${escapedDescription}\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.setAttribute('href', URL.createObjectURL(blob));
    link.setAttribute('download', filename + '.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    lastSaveTime = new Date();
    alert(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${newPlaces.length} –Ω–æ–≤—ã—Ö –º–µ—Å—Ç –≤ —Ñ–∞–π–ª ${filename}.csv`);
  }

  function clearCustomPoints() {
    const customPlaces = allPlaces.filter(place => place.isCustom);
    if (customPlaces.length === 0) { alert('–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!'); return; }

    if (confirm(`–£–¥–∞–ª–∏—Ç—å ${customPlaces.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Å—Ç?`)) {
      customPlaces.forEach(place => {
        vectorSource.removeFeature(place.feature);
        if (place.feature.get('overlay')) {
          map.removeOverlay(place.feature.get('overlay'));
        }
      });
      allPlaces = allPlaces.filter(place => !place.isCustom);
      updateStats();
      alert('üóëÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Å—Ç–∞ —É–¥–∞–ª–µ–Ω—ã!');
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ food-le.csv
  function downloadFoodCSV() {
    // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    const link = document.createElement('a');
    link.setAttribute('href', 'food-le.csv');
    link.setAttribute('download', 'food-le.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  document.getElementById('file-input').addEventListener('change', e => {
    const file = e.target.files[0];
    if(!file) return;
    
    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: function(results){
        let bounds = [];
        let loadedCount = 0;
        
        results.data.forEach(place => {
          const name = place.name || place.place || place.location;
          const lat = parseFloat(place.latitude || place.lat);
          const lon = parseFloat(place.longitude || place.lng || place.lon);
          const description = place.description || "";
          
          if(!isNaN(lat) && !isNaN(lon)) {
            addMarker({name, lat, lng: lon, description}, true);
            bounds.push([lon, lat]);
            loadedCount++;
          }
        });
        
        if (bounds.length > 0) {
          const extent = ol.extent.boundingExtent(bounds.map(coord => ol.proj.fromLonLat(coord)));
          map.getView().fit(extent, { padding: [20, 20, 20, 20] });
        }
        alert(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${loadedCount} –º–µ—Å—Ç`);
      },
      error: function(error) { alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error); }
    });
  });

  // Map control buttons
  document.getElementById('reset-view').addEventListener('click', function() {
    map.getView().setCenter(ol.proj.fromLonLat([77.5771, 34.1526]));
    map.getView().setZoom(8);
  });
  document.getElementById('save-all-btn').addEventListener('click', saveAllPoints);
  document.getElementById('save-new-btn').addEventListener('click', saveNewPoints);
  document.getElementById('download-food-btn').addEventListener('click', downloadFoodCSV);
  document.getElementById('quick-save-btn').addEventListener('click', saveAllPoints);
  document.getElementById('quick-save-new-btn').addEventListener('click', saveNewPoints);
  document.getElementById('quick-download-food-btn').addEventListener('click', downloadFoodCSV);
  document.getElementById('clear-custom-btn').addEventListener('click', clearCustomPoints);
  
  // New delete all buttons
  document.getElementById('delete-all-btn').addEventListener('click', deleteAllPoints);
  document.getElementById('quick-delete-all-btn').addEventListener('click', deleteAllPoints);

  // Prevent map click when clicking buttons
  document.querySelectorAll('.map-controls button').forEach(btn => {
    btn.addEventListener('click', function(event){
      event.stopPropagation();
    });
  });

  // Add predefined places
  samplePlaces.forEach(p => addMarker(p, false));
</script>
</body>
</html>
